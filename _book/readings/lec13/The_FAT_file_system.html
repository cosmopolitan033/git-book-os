
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>The FAT File System Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="file-implementation.html" />
    
    
    <link rel="prev" href="File_types.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../lec1/">
            
                <a href="../lec1/">
            
                    
                    Lecture 1: Introduction to Operating Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../lec1/Principles.html">
            
                <a href="../lec1/Principles.html">
            
                    
                    Principles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../lec1/intro.html">
            
                <a href="../lec1/intro.html">
            
                    
                    Introduction to Operating Systems
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../lec2/">
            
                <a href="../lec2/">
            
                    
                    Lecture 2: Software and Interface Stability
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../lec2/Interface_stability.html">
            
                <a href="../lec2/Interface_stability.html">
            
                    
                    Interface Stability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../lec2/Software_interfaces.html">
            
                <a href="../lec2/Software_interfaces.html">
            
                    
                    Software Interfaces
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../lec3/">
            
                <a href="../lec3/">
            
                    
                    Lecture 3: Interface Stability and Software Interfaces
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../lec3/Interface_Stability.html">
            
                <a href="../lec3/Interface_Stability.html">
            
                    
                    Interface Stability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../lec3/Software_Interfaces.html">
            
                <a href="../lec3/Software_Interfaces.html">
            
                    
                    Software Interfaces
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../lec4/">
            
                <a href="../lec4/">
            
                    
                    Lecture 4: CPU and Virtualization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../lec4/Linking_and_libraries.html">
            
                <a href="../lec4/Linking_and_libraries.html">
            
                    
                    Linking and Libraries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../lec4/cpu-api.html">
            
                <a href="../lec4/cpu-api.html">
            
                    
                    CPU API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../lec4/cpu-intro.html">
            
                <a href="../lec4/cpu-intro.html">
            
                    
                    CPU Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../lec4/cpu-mechanisms.html">
            
                <a href="../lec4/cpu-mechanisms.html">
            
                    
                    CPU Mechanisms
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../lec5/">
            
                <a href="../lec5/">
            
                    
                    Lecture 5: CPU Scheduling
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../lec5/cpu-sched-mlfq.html">
            
                <a href="../lec5/cpu-sched-mlfq.html">
            
                    
                    CPU Scheduling - MLFQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../lec5/cpu-sched.html">
            
                <a href="../lec5/cpu-sched.html">
            
                    
                    CPU Scheduling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../lec6/">
            
                <a href="../lec6/">
            
                    
                    Lecture 6: Virtual Memory
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../lec6/Garbage_Collection.html">
            
                <a href="../lec6/Garbage_Collection.html">
            
                    
                    Garbage Collection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../lec6/vm-api.html">
            
                <a href="../lec6/vm-api.html">
            
                    
                    VM API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../lec6/vm-freespace.html">
            
                <a href="../lec6/vm-freespace.html">
            
                    
                    VM Free Space Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../lec6/vm-intro.html">
            
                <a href="../lec6/vm-intro.html">
            
                    
                    VM Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../lec6/vm-mechanism.html">
            
                <a href="../lec6/vm-mechanism.html">
            
                    
                    VM Mechanisms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../lec6/vm-segmentation.html">
            
                <a href="../lec6/vm-segmentation.html">
            
                    
                    VM Segmentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../lec7/">
            
                <a href="../lec7/">
            
                    
                    Lecture 7: Advanced VM
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../lec7/Working_set_page_replacement.html">
            
                <a href="../lec7/Working_set_page_replacement.html">
            
                    
                    Working Set Page Replacement
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../lec7/vm-beyondphys-policy.html">
            
                <a href="../lec7/vm-beyondphys-policy.html">
            
                    
                    Beyond Physical Memory - Policy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../lec7/vm-beyondphys.html">
            
                <a href="../lec7/vm-beyondphys.html">
            
                    
                    Beyond Physical Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../lec7/vm-paging.html">
            
                <a href="../lec7/vm-paging.html">
            
                    
                    Paging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../lec7/vm-tlbs.html">
            
                <a href="../lec7/vm-tlbs.html">
            
                    
                    TLBs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../lec8/">
            
                <a href="../lec8/">
            
                    
                    Lecture 8: Concurrency and Threads
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../lec8/Introduction_to_IPC.html">
            
                <a href="../lec8/Introduction_to_IPC.html">
            
                    
                    Introduction to IPC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../lec8/User-Mode_Threads.html">
            
                <a href="../lec8/User-Mode_Threads.html">
            
                    
                    User-Mode Threads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../lec8/threads-api.html">
            
                <a href="../lec8/threads-api.html">
            
                    
                    Threads API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../lec8/threads-intro.html">
            
                <a href="../lec8/threads-intro.html">
            
                    
                    Threads Introduction
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../lec9/">
            
                <a href="../lec9/">
            
                    
                    Lecture 9: Synchronization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../lec9/flock2_man_page.html">
            
                <a href="../lec9/flock2_man_page.html">
            
                    
                    flock(2) man page
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../lec9/locks3_man_page.html">
            
                <a href="../lec9/locks3_man_page.html">
            
                    
                    locks(3) man page
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../lec9/threads-locks.html">
            
                <a href="../lec9/threads-locks.html">
            
                    
                    Threads and Locks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../lec10/">
            
                <a href="../lec10/">
            
                    
                    Lecture 10: Threads - Advanced Concepts
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../lec10/threads-cv.html">
            
                <a href="../lec10/threads-cv.html">
            
                    
                    Threads - Condition Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../lec10/threads-locks-usage.html">
            
                <a href="../lec10/threads-locks-usage.html">
            
                    
                    Threads - Locks Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../lec10/threads-sema.html">
            
                <a href="../lec10/threads-sema.html">
            
                    
                    Threads - Semaphores
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../lec11/">
            
                <a href="../lec11/">
            
                    
                    Lecture 11: Debugging and Synchronization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../lec11/Deadlock_Avoidance.html">
            
                <a href="../lec11/Deadlock_Avoidance.html">
            
                    
                    Deadlock Avoidance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../lec11/Health_Monitoring.html">
            
                <a href="../lec11/Health_Monitoring.html">
            
                    
                    Health Monitoring
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../lec11/Java_intrinsic_locks.html">
            
                <a href="../lec11/Java_intrinsic_locks.html">
            
                    
                    Java Intrinsic Locks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../lec11/Java_synchronization.html">
            
                <a href="../lec11/Java_synchronization.html">
            
                    
                    Java Synchronization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../lec11/threads-bugs.html">
            
                <a href="../lec11/threads-bugs.html">
            
                    
                    Threads - Debugging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../lec12/">
            
                <a href="../lec12/">
            
                    
                    Lecture 12: Device Drivers and Storage
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../lec12/Devices_Classes_and_Services.html">
            
                <a href="../lec12/Devices_Classes_and_Services.html">
            
                    
                    Devices, Classes, and Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../lec12/Dynamically_loadable_device_drivers.html">
            
                <a href="../lec12/Dynamically_loadable_device_drivers.html">
            
                    
                    Dynamically Loadable Device Drivers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../lec12/file-devices.html">
            
                <a href="../lec12/file-devices.html">
            
                    
                    File Devices
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="./">
            
                <a href="./">
            
                    
                    Lecture 13: File Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="File_types.html">
            
                <a href="File_types.html">
            
                    
                    File Types
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.14.2" data-path="The_FAT_file_system.html">
            
                <a href="The_FAT_file_system.html">
            
                    
                    The FAT File System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="file-implementation.html">
            
                <a href="file-implementation.html">
            
                    
                    File Implementation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="file-intro.html">
            
                <a href="file-intro.html">
            
                    
                    Introduction to File Systems
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../lec14/">
            
                <a href="../lec14/">
            
                    
                    Lecture 14: The Fast File System
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../lec14/file-ffs.html">
            
                <a href="../lec14/file-ffs.html">
            
                    
                    The Fast File System (FFS)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../lec15/">
            
                <a href="../lec15/">
            
                    
                    Lecture 15: Modern File Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../lec15/file-journaling.html">
            
                <a href="../lec15/file-journaling.html">
            
                    
                    Journaling File Systems
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="../lec15/file-lfs.html">
            
                <a href="../lec15/file-lfs.html">
            
                    
                    Log-structured File Systems
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="../lec15/file-ssd.html">
            
                <a href="../lec15/file-ssd.html">
            
                    
                    Solid State Drives and File Systems
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../lec16/">
            
                <a href="../lec16/">
            
                    
                    Lecture 16: Virtual Machine Monitors
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="../lec16/vmm-intro.html">
            
                <a href="../lec16/vmm-intro.html">
            
                    
                    Introduction to VMM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../lec17/">
            
                <a href="../lec17/">
            
                    
                    Lecture 17: Security
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="../lec17/dialogue-security.html">
            
                <a href="../lec17/dialogue-security.html">
            
                    
                    Dialogue on Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="../lec17/security-access.html">
            
                <a href="../lec17/security-access.html">
            
                    
                    Access Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3" data-path="../lec17/security-authentication.html">
            
                <a href="../lec17/security-authentication.html">
            
                    
                    Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.4" data-path="../lec17/security-crypto.html">
            
                <a href="../lec17/security-crypto.html">
            
                    
                    Cryptography
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.5" data-path="../lec17/security-intro.html">
            
                <a href="../lec17/security-intro.html">
            
                    
                    Introduction to Security
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >The FAT File System</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="the-fat-file-system">The FAT File System</h1>
<h2 id="an-introduction-to-dos-fat-volume-and-file-structure">An Introduction to DOS FAT Volume and File Structure</h2>
<h4 id="mark-kampe-markkcsuclaedu">Mark Kampe <a href="mailto:markk@cs.ucla.edu" target="_blank">markk@cs.ucla.edu</a></h4>
<h4 id="1-introduction">1. Introduction</h4>
<p>When the first personal computers with disks became available, they were very small (a few megabytes of disk and a few dozen kilobytes of memory). A file system implementation for such machines had to impose very little overhead on disk space, and be small enough to fit in the BIOS ROM. BIOS stands for <strong>BASIC I/O Subsystem</strong>. Note that the first word is all upper-case. The purpose of the BIOS ROM was to provide run-time support for a BASIC interpreter (which is what Bill Gates did for a living before building DOS). DOS was never intended to provide the features and performance of real timesharing systems.</p>
<p>Disk and memory size have increased in the last thirty years, People now demand state-of-the-art power and functionality from their PCs. Despite the evolution that the last decades have seen, old standards die hard. Much as European train tracks maintain the same wheel spacing used by Roman chariots, most modern OSs still support DOS FAT file systems. DOS file systems are not merely around for legacy reasons. The ISO 9660 CDROM file system format is a descendent of the DOS file system.</p>
<p>The DOS FAT file system is worth studying because:</p>
<ul>
<li>It is heavily used all over the world, and is the basis for more modern file system (like 9660).</li>
<li>It provides reasonable performance (large transfers and well clustered allocation) with a very simple implementation.</li>
<li>It is a very successful example of &quot;linked list&quot; space allocation.</li>
</ul>
<h4 id="2-structural-overview">2. Structural Overview</h4>
<p>All file systems include a few basic types of data structures:</p>
<ul>
<li><p>bootstrap</p>
<p>code to be loaded into memory and executed when the computer is powered on. MVS volumes reserve the entire first track of the first cylinder for the boot strap.</p>
</li>
<li><p>volume descriptors</p>
<p>information describing the size, type, and layout of the file system ... and in particular how to find the other key meta-data descriptors.</p>
</li>
<li><p>file descriptors</p>
<p>information that describes a file (ownership, protection, time of last update, etc.) and points where the actual data is stored on the disk.</p>
</li>
<li><p>free space descriptors</p>
<p>lists of blocks of (currently) unused space that can be allocated to files.</p>
</li>
<li><p>file name descriptors</p>
<p>data structures that user-chosen names with each file.</p>
</li>
</ul>
<p>DOS FAT file systems divide the volume into fixed-sized (physical) blocks, which are grouped into larger fixed-sized (logical) block clusters.</p>
<p>The first block of DOS FAT volume contains the bootstrap, along with some volume description information. After this comes a much longer <strong>File Allocation Table</strong> (FAT from which the file system takes its name). The File Allocation Table is used, both as a free list, and to keep track of which blocks have been allocated to which files.</p>
<p>The remainder of the volume is data clusters, which can be allocated to files and directories. The first file on the volume is the root directory, the top of the tree from which all other files and directories on the volume can be reached.</p>
<p><img src="https://raw.githubusercontent.com/markkampe/Operating-Systems-Reading/master/DOS/dosvol.gif" alt="img"></p>
<h4 id="3-boot-block-bios-parameter-block-and-fdisk-table">3. Boot block BIOS Parameter Block and FDISK Table</h4>
<p>Most file systems separate the first block (pure bootstrap code) from volume description information. DOS file systems often combine these into a single block. The format varies between (partitioned) hard disks and (unpartitioned) floppies, and between various releases of DOS and Windows ... but conceptually, the boot record:</p>
<ul>
<li>begins with a branch instruction (to the start of the real bootstrap code).</li>
<li>followed by a volume description (BIOS Parameter Block)</li>
<li>followed by the real bootstrap code</li>
<li>followed by an optional disk partitioning table</li>
<li>followed by a signature (for error checking).</li>
</ul>
<p><img src="https://raw.githubusercontent.com/markkampe/Operating-Systems-Reading/master/DOS/dosboot.gif" alt="img"></p>
<h4 id="31-bios-parameter-block">3.1 BIOS Parameter Block</h4>
<p>After the first few bytes of the bootstrap comes the BIOS parameter block, which contains a brief summary of the device and file system. It describes the device geometry:</p>
<ul>
<li>number of bytes per (physical) sector</li>
<li>number of sectors per track</li>
<li>number of tracks per cylinder</li>
<li>total number of sectors on the volume</li>
</ul>
<p>It also describes the way the file system is laid out on the volume:</p>
<ul>
<li>number of sectors per (logical) cluster</li>
<li>the number of reserved sectors (not part of file system)</li>
<li>the number of Alternate File Allocation Tables</li>
<li>the number of entries in the root directory</li>
</ul>
<p>These parameters enable the OS to interpret the remainder of the file system.</p>
<h4 id="32-fdisk-table">3.2 FDISK Table</h4>
<p>As disks got larger, the people at MicroSoft figured out that their customers might want to put multiple file systems on each disk. This meant they needed some way of partitioning the disk into logical sub-disks. To do this, they added a small partition table (sometimes called the FDISK table, because of the program that managed it) to the end of the boot strap block.</p>
<p>This FDISK table has four entries, each capable of describing one disk partition. Each entry includes</p>
<ul>
<li>A partition type (e.g. Primary DOS partition, UNIX partition).</li>
<li>An ACTIVE indication (is this the one we boot from).</li>
<li>The disk address where that partition starts and ends.</li>
<li>The number of sectors contained within that partition.</li>
</ul>
<table>
<thead>
<tr>
<th>Partn</th>
<th>Type</th>
<th>Active</th>
<th>Start (C:H:S)</th>
<th>End (C:H:S)</th>
<th>Start (logical)</th>
<th>Size (sectors)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>LINUX</td>
<td>True</td>
<td>1:0:0</td>
<td>199:7:49</td>
<td>400</td>
<td>79,600</td>
</tr>
<tr>
<td>2</td>
<td>Windows NT</td>
<td></td>
<td>200:0:0</td>
<td>349:7:49</td>
<td>80,000</td>
<td>60,000</td>
</tr>
<tr>
<td>3</td>
<td>FAT 32</td>
<td></td>
<td>350:0:0</td>
<td>399:7:49</td>
<td>140,000</td>
<td>20,000</td>
</tr>
<tr>
<td>4</td>
<td>NONE</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>In older versions of DOS the starting/ending addresses were specified as cylinder/sector/head. As disks got larger, this became less practical, and they moved to logical block numbers.</p>
<p>The addition of disk partitioning also changed the structure of the boot record. The first sector of a disk contains the Master Boot Record (MBR) which includes the FDISK table, and a bootstrap that finds the active partition, and reads in its first sector (Partition Boot Record). Most people (essentially everyone but Bill Gates :-) make their MBR bootstrap ask what system you want to boot from, and boot the active one by default after a few seconds. This gives you the opportunity to choose which OS you want to boot. Microsoft makes this decision for you ... you want to boot Windows.</p>
<p>The structure of the Partition Boot Record is entirely operating system and file system specific ... but for DOS FAT file system partitions, it includes a BIOS Parameter block as described above.</p>
<h4 id="4-file-descriptors-directories">4. File Descriptors (directories)</h4>
<p>In keeping with their desire for simplicity, DOS file systems combine both file description and file naming into a single file descriptor (directory entries). A DOS directory is a file (of a special type) that contains a series of fixed sized (32 byte) directory entries. Each entry describes a single file:</p>
<ul>
<li>an 11-byte name (8 characters of base name, plus a 3 character extension).</li>
<li>a byte of attribute bits for the file, which include:<ul>
<li>Is this a file, or a sub-directory.</li>
<li>Has this file changed since the last backup.</li>
<li>Is this file hidden.</li>
<li>Is this file read-only.</li>
<li>Is this a system file.</li>
<li>Does this entry describe a volume label.</li>
</ul>
</li>
<li>times and dates of creation and last modification, and date of last access.</li>
<li>a pointer to the first logical block of the file. (This field is only 16 bits wide, and so when Microsoft introduced the FAT32 file system, they had to put the high order bits in a different part of the directory entry).</li>
<li>the length (number of valid data bytes) in the file.</li>
</ul>
<table>
<thead>
<tr>
<th>Name (8+3)</th>
<th>Attributes</th>
<th>Last Changed</th>
<th>First Cluster</th>
<th>Length</th>
</tr>
</thead>
<tbody>
<tr>
<td>.</td>
<td>DIR</td>
<td>08/01/03 11:15:00</td>
<td>61</td>
<td>2,048</td>
</tr>
<tr>
<td>..</td>
<td>DIR</td>
<td>06/20/03 08:10:24</td>
<td>1</td>
<td>4,096</td>
</tr>
<tr>
<td>MARK</td>
<td>DIR</td>
<td>10/15/04 21:40:12</td>
<td>130</td>
<td>1,800</td>
</tr>
<tr>
<td>README.TXT</td>
<td>FILE</td>
<td>11/02/04 04:27:36</td>
<td>410</td>
<td>31,280</td>
</tr>
</tbody>
</table>
<p>If the first character of a files name is a NULL (0x00) the directory entry is unused. The special character (0xE5) in the first character of a file name is used to indicate that a directory entry describes a deleted file. (See the section on Garbage collection below)</p>
<h5 id="note-on-times-and-dates">Note on times and dates:</h5>
<p>DOS stores file modification times and dates as a pair of 16-bit numbers:</p>
<ul>
<li>7 bits of year, 4 bits of month, 5 bits of day of month</li>
<li>5 bits of hour, 6 bits of minute, 5 bits of seconds (x2).</li>
</ul>
<p>All file systems use dates relative to some epoch (time zero). For DOS, the epoch is midnight, New Year&apos;s Eve, January 1, 1980. A seven bit field for years means that the the DOS calendar only runs til 2107. Hopefully, nobody will still be using DOS file systems by then :-)</p>
<h4 id="5-links-and-free-space-file-allocation-table">5. Links and Free Space (File Allocation Table)</h4>
<p>Many file systems have very compact (e.g. bitmap) free lists, but most of them use some per-file data structure to keep track of which blocks are allocated to which file. The DOS File Allocation Table is a relatively unique design. It contains one entry for each logical block in the volume. If a block is free, this is indicated by the FAT entry. If a block is allocated to a file, the FAT entry gives the logical block number of the <strong>next</strong> logical block in the file.</p>
<h4 id="51-cluster-size-and-performance">5.1 Cluster Size and Performance</h4>
<p>Space is allocated to files, not in (physical) blocks, but in (logical) multi-block clusters. The number of clusters per block is determined when the file system is created.</p>
<p>Allocating space to files in larger chunks improves I/O performance, by reducing the number of operations required to read or write a file. This comes at the cost of higher internal fragmentation (since, on average, half of the last cluster of each file is left unused). As disks have grown larger, people have become less concerned about internal fragmentation losses, and cluster sizes have increased.</p>
<p>The maximum number of clusters a volume can support depends on the width of the FAT entries. In the earliest FAT file systems (designed for use on floppies, and small hard drives). An 8-bit wide FAT entry would have been too small (256 * 512 = 128K bytes) to describe even the smallest floppy, but a 16-bit wide FAT entry would have been ludicrously large (8-16 Megabytes) ... so Microsoft compromised and adopted 12-bit wide FAT entries (two entries in three bytes). These were called FAT-12 file systems. As disks got larger, they created 2-byte wide (FAT-16) and 4-byte wide (FAT-32) file systems.</p>
<h4 id="52-next-block-pointers">5.2 Next Block Pointers</h4>
<p>A file&apos;s directory entry contains a pointer to the first cluster of that file. The File Allocation Table entry for that cluster tells us the cluster number <strong>next</strong> cluster in the file. When we finally get to the last cluster of the file, its FAT entry will contain a -1, indicating that there is no next block in the file.</p>
<p><img src="https://raw.githubusercontent.com/markkampe/Operating-Systems-Reading/master/DOS/dosfat.gif" alt="img"></p>
<p>The &quot;next block&quot; organization of the FAT means that in order to figure out what physical cluster is the third logical block of a file, must know the physical cluster number of the second logical block. This is not usually a problem, because almost all file access is sequential (reading the first block, and then the second, and then the third ...).</p>
<p>If we had to go to disk to re-read the FAT each time we needed to figure out the next block number, the file system would perform very poorly. Fortunately, the FAT is so small (e.g. 512 bytes per megabyte of file system) that the entire FAT can be kept in memory as long as a file system is in use. This means that successor block numbers can be looked up without the need to do any additional disk I/O. It is easy to imagine</p>
<h4 id="53-free-space">5.3 Free Space</h4>
<p>The notion of &quot;next block&quot; is only meaningful for clusters that are allocated to a file ... which leaves us free to use the FAT entries associated with free clusters as a free indication. Just as we reserved a value (-1) to mean <strong>end of file</strong> we can reserve another value (0) to mean <strong>this cluster is free</strong>.</p>
<p>To find a free cluster, one has but to search the FAT for an entry with the value -2. If we want to find a free cluster near the clusters that are already allocated to the file, we can start our search with the FAT entry after the entry for the first cluster in the file.</p>
<p><img src="https://raw.githubusercontent.com/markkampe/Operating-Systems-Reading/master/DOS/dosfree.gif" alt="img"></p>
<h4 id="54-garbage-collection">5.4 Garbage Collection</h4>
<p>Older versions of FAT file systems did not bother to free blocks when a file was deleted. Rather, they merely crossed out the first byte of the file name in the directory entry (with the reserved value 0xE5). This had the advantage of greatly reducing the amount of I/O associated with file deletion ... but it meant that DOS file systems regularly ran out of space.</p>
<p>When this happened, they would initiate garbage collection. Starting from the root directory, they would find every &quot;valid&quot; entry. They would follow the chain of next block pointers to determine which clusters were associated with each file, and recursively enumerate the contents of all sub-directories. After completing the enumeration of all allocated clusters, they inferred that any cluster not found in some file was free, and marked them as such in the File Allocation Table.</p>
<p>This &quot;feature&quot; was probably motivated by a combination of laziness and a desire for performance. It did, however, have an advantage. Since clusters were not freed when files were deleted, they could not be reallocated until after garbage collection was performed. This meant that it might be possible to recover the contents of deleted files for quite a while. The opportunity this created was large enough to enable Peter Norton to start a very successful company.</p>
<h4 id="6-descendants-of-the-dos-file-system">6. Descendants of the DOS file system</h4>
<p>The DOS file system has evolved with time. Not only have wider (16- and 32-bit) FAT entries been used to support larger disks, but other features have been added. The last stand-alone DOS product was DOS 6.x. After this, all DOS support was under Windows, and along with the change to Windows came an enhanced version of the FAT file system called Virtual FAT (or simply VFAT).</p>
<h4 id="61-long-file-names">6.1 Long File Names</h4>
<p>Most DOS and Windows systems were used for personal productivity, and their users didn&apos;t demand much in the way of file system features. Their biggest complaints were about the 8+3 file names. Windows users demanded longer and mixed-case file names.</p>
<p>The 32 byte directory entries didn&apos;t have enough room to hold longer names, and changing the format of DOS directories would break hundreds or even thousands of applications. It wasn&apos;t merely a matter of importing files from old systems to new systems. DOS diskettes are commonly used to carry files between various systems ... which means that old systems still had to be able to read the new directories. They had to find a way to support longer file names without making the new files unreadable by older systems.</p>
<p>The solution they came up was to put the extended filenames in additional (auxiliary) directory entries. Each file would be described by an old-format directory entry, but supplementary directory entries (following the primary directory entry) could provide extensions to the file name. To keep older systems from being confused by the new directory entries, they were tagged with a very unusual set of attributes (hidden, system, read-only, volume label). Older systems would ignore new entries, but would still be able to access new files under their 8+3 names in the old-style directory entries. New systems would recognize the new directory entries, and be able to access files by either the long or the short names.</p>
<p><img src="https://raw.githubusercontent.com/markkampe/Operating-Systems-Reading/master/DOS/doslongdir.gif" alt="img"></p>
<p>The addition of long file names did create one problem for the old directory entries. What would you do if you had two file names that differed only after the 8th character (e.g. datafileread.c and datafilewrite.c)? If we just used the first 8 characters of the file name in the old directory entries (datafile), we would have two files with the same name, and this is illegal. For this reason, the the short file names are not merely the first eight characters of the long file names. Rather, the last two bytes of the short name were merely made unambiguous (e.g. &quot;~1&quot;, &quot;~2&quot;, etc).</p>
<h4 id="62-alternateback-up-fats">6.2 Alternate/back-up FATs</h4>
<p>The File Allocation Table is a very concise way of keeping track of all of the next-block pointers in the file system. If anything ever happened to the File Allocation Table, the results would be disastrous. The directory entries would tell us where the first blocks of all files were, but we would have no way of figuring out where the remainder of the data was.</p>
<p>Events that corrupt the File Allocation Table are extremely rare, but the consequences of such an incident are catastrophic. To protect users from such eventualities, MicroSoft added support for alternate FATs. Periodically, the primary FAT would be copied to one of the pre-reserved alternate FAT locations. Then if something bad happened to the primary FAT, it would still be possible to read most files (files created before the copy) by using the back-up FAT. This is an imperfect solution, as losing new files is bad ... but losing all files is worse.</p>
<h4 id="63-iso-9660">6.3 ISO 9660</h4>
<p>When CDs were proposed for digital storage, everyone recognized the importance of a single standard file system format. Dueling formats would raise the cost of producing new products ... and this would be a lose for everyone. To respond to this need, the International Standards Organization chartered a sub-committee to propose such a standard.</p>
<p>The failings of the DOS file system were widely known by this time, but, as the most widely used file system on the planet, the committee members could not ignore it. Upon examination, it became clear that the most idiomatic features of the DOS file system (the File Allocation Table) were irrelevant to a CDROM file system (which is written only once):</p>
<ul>
<li>We don&apos;t need to keep track of the free space on a CD ROM. We write each file contiguously, and the next file goes immediately after the last one.</li>
<li>Because files can be written contiguously, we don&apos;t need any &quot;next block&quot; pointers. All we need to know about a file is where its first block resides.</li>
</ul>
<p>It was decided that ISO 9660 file systems would (like DOS file systems) have tree structured directory hierarchies, and that (like DOS) each directory entry would describe a single file (rather than having some auxiliary data structure like and I-node to do this). 9660 directory entries, like DOS directory entries, contain:</p>
<ul>
<li>file name (within the current directory)</li>
<li>file type (e.g. file or directory)</li>
<li>location of the file&apos;s first block</li>
<li>number of bytes contained in the file</li>
<li>time and date of creation</li>
</ul>
<p>They did, however, learn from DOS&apos;s mistakes:</p>
<ul>
<li>Realizing that new information would be added to directory entries over time, they made them variable length. Each directory entry begins with a length field (giving the number of bytes in this directory entry, and thus the number of bytes until the next directory entry).</li>
<li>Recognizing the need to support long file names, they also made the file name field in each entry a variable length field.</li>
<li>Recognizing that, over time, people would want to associate a wide range of attributes with files, they also created a variable length extended attributes section after the file name. Much of this section has been left unused, but they defined several new attributes for files:<ul>
<li>file owner</li>
<li>owning group</li>
<li>permissions</li>
<li>creation, modification, effective, and expiration times</li>
<li>record format, attributes, and length information</li>
</ul>
</li>
</ul>
<p>But, even though 9660 directory entries include much more information than DOS directory entries, it remains that 9660 volumes resemble DOS file systems much more than they resemble any other file system format. And so, the humble DOS file system is reborn in a new generation of products.</p>
<h4 id="7-summary">7. Summary</h4>
<p>DOS file systems are very simple, They don&apos;t support multiple links to a file, or symbolic links, or even multi-user access control. They are also and very economical in terms of the space they take up. Free block lists, and file block pointers are combined into a single (quite compact) File Allocation Table. File descriptors are incorporated into the directory entries. And for all of these limitations, they are probably the most widely used file system format on the planet. Despite their primitiveness, DOS file systems were used as the basis for much newer CD ROM file system designs.</p>
<p>What can we infer from this? That most users don&apos;t need a lot of fancy features, and that the DOS file system (primitive as it may be) covers their needs pretty well.</p>
<p>It is also noteworthy that when Microsoft was finally forced to change the file system format to get past the 8.3 upper case file name limitations, they chose to do so with a kludgy (but upwards compatible) solution using additional directory entries per file. The fact that they chose such an implementation clearly illustrates the importance of maintaining media interchangeability with older systems. This too is a problem that all (successful) file systems will eventually face.</p>
<h4 id="8-references">8. References</h4>
<p>DOS file system information</p>
<ul>
<li></li>
<li>PC Guide&apos;s <a href="http://www.pcguide.com/ref/hdd/file/fat_Long.htm" target="_blank">Overview of DOS FAT file systems</a>. (this is a pointer to the long filename article ... but the entire library is nothing short of excellent).</li>
<li>Free BSD sources, PCFS implementation, <a href="https://raw.githubusercontent.com/markkampe/Operating-Systems-Reading/master/DOS/freebsd/bpb_h.txt" target="_blank">BIOS Parameter block format</a>, and (Open Solaris) <a href="https://raw.githubusercontent.com/markkampe/Operating-Systems-Reading/master/DOS/opensolaris/fdisk_h.txt" target="_blank">FDISK table format</a>.</li>
<li>Free BSD sources, PCFS implementation, <a href="https://raw.githubusercontent.com/markkampe/Operating-Systems-Reading/master/DOS/freebsd/direntry_h.txt" target="_blank">Directory Entry format</a></li>
</ul>
<p>9660 file system information</p>
<ul>
<li>Wikipedia Introduction to <a href="http://en.wikipedia.org/wiki/ISO_9660" target="_blank">ISO 9660 file systems</a></li>
<li>Free BSD sources, ISOFS implementation, <a href="https://raw.githubusercontent.com/markkampe/Operating-Systems-Reading/master/DOS/freebsd/iso_h.txt" target="_blank">ISO 9660 data structures</a>.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="File_types.html" class="navigation navigation-prev " aria-label="Previous page: File Types">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="file-implementation.html" class="navigation navigation-next " aria-label="Next page: File Implementation">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"The FAT File System","level":"1.14.2","depth":2,"next":{"title":"File Implementation","level":"1.14.3","depth":2,"path":"readings/lec13/file-implementation.md","ref":"readings/lec13/file-implementation.md","articles":[]},"previous":{"title":"File Types","level":"1.14.1","depth":2,"path":"readings/lec13/File_types.md","ref":"readings/lec13/File_types.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"readings/lec13/The_FAT_file_system.md","mtime":"2024-03-11T16:10:58.729Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-03-12T00:45:26.750Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

